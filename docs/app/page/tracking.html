<!DOCTYPE html><html lang="en"><head><title>app/page/tracking</title></head><meta http-equiv="Content-Type" content="text/html; charset=utf-8"><meta name="viewport" content="width=device-width, initial-scale=1.0, minimum-scale=1.0, maximum-scale=1.0"><meta name="groc-relative-root" content="../../"><meta name="groc-document-path" content="app/page/tracking"><meta name="groc-project-path" content="assets/js/app/page/tracking.js"><meta name="groc-github-url" content="https://github.com/zooron/carrier-tracking-customer"><link rel="stylesheet" type="text/css" media="all" href="../../assets/style.css"><script type="text/javascript" src="../../assets/behavior.js"></script><body><div id="meta"><div class="file-path"><a href="https://github.com/zooron/carrier-tracking-customer/blob/master/assets/js/app/page/tracking.js">assets/js/app/page/tracking.js</a></div></div><div id="document"><div class="segment"><div class="code"><div class="wrapper"><span class="hljs-built_in">module</span>.exports = [
  <span class="hljs-string">'$routeParams'</span>, <span class="hljs-string">'$location'</span>, <span class="hljs-string">'$filter'</span>, <span class="hljs-string">'CommonRequest'</span>, <span class="hljs-string">'CommonMoment'</span>, <span class="hljs-string">'CommonTracking'</span>, <span class="hljs-string">'StorageTracking'</span>, <span class="hljs-string">'CommonUi'</span>,
  <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">
    $routeParams, $location, $filter, CommonRequest, CommonMoment, CommonTracking, StorageTracking, CommonUi
  </span>) </span>{
<span class="hljs-pi">    'use strict'</span>;
    <span class="hljs-keyword">var</span> self = <span class="hljs-keyword">this</span>;

    self.data = StorageTracking.data;
    self.trackingId = StorageTracking.trackingId || <span class="hljs-string">''</span>;
    self.availableStates = [
      <span class="hljs-string">'LABEL_PRINTED'</span>,
      <span class="hljs-string">'IN_TRANSIT'</span>,
      <span class="hljs-string">'HANDOVER'</span>,
      <span class="hljs-string">'WAREHOUSE'</span>,
      <span class="hljs-string">'IN_DELIVERY'</span>,
      <span class="hljs-string">'DELIVERED'</span>
    ];
    self.errorStates = [
      <span class="hljs-string">'NOT_AVAILABLE'</span>,
      <span class="hljs-string">'NO_HANDOVER'</span>,
      <span class="hljs-string">'DELIVERY_FAILED'</span>,
      <span class="hljs-string">'RECEIVER_MOVED'</span>,
      <span class="hljs-string">'CANCELLED'</span>
    ];
    self.showError = <span class="hljs-literal">false</span>;
    self.state = -<span class="hljs-number">1</span>;
    self.errorState = -<span class="hljs-number">1</span>;
    self.carrierInfo = <span class="hljs-literal">null</span>;</div></div></div><div class="segment"><div class="comments "><div class="wrapper"><p>IN_TRANSIT.FORWARD.DISTRIBUTION_CENTER
HANDOVER.CARRIER.LOCATION
WAREHOUSE
NOT_AVAILABLE.RECEIVER.NEW_DELIVERY_ATTEMPT</p></div></div><div class="code"><div class="wrapper">    self.packageStates = [ {
      tooltip: <span class="hljs-string">'LABEL_PRINTED'</span>,
      icon: <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>{
        <span class="hljs-keyword">return</span> <span class="hljs-string">'cube'</span>;
      },
      isActive: <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>{
        <span class="hljs-keyword">return</span> self.state &gt;= <span class="hljs-number">0</span>;
      },
      showCheckmark: <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>{
        <span class="hljs-keyword">return</span> self.state &gt;= <span class="hljs-number">0</span>;
      },
      showCross: <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>{
        <span class="hljs-keyword">return</span> self.errorState === <span class="hljs-number">0</span>;
      }
    }, {
      tooltip: <span class="hljs-string">'IN_TRANSIT'</span>,
      angle: <span class="hljs-string">'angle-right'</span>,
      iconModifier: <span class="hljs-string">'fa-flip-horizontal'</span>,
      icon: <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>{
        <span class="hljs-keyword">return</span> <span class="hljs-string">'truck'</span>;
      },
      isActive: <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>{
        <span class="hljs-keyword">return</span> self.state &gt;= <span class="hljs-number">1</span> &amp;&amp; self.state &lt; <span class="hljs-number">7</span>;
      },
      showCheckmark: <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>{
        <span class="hljs-keyword">return</span> self.state &gt;= <span class="hljs-number">1</span> &amp;&amp; self.state &lt; <span class="hljs-number">7</span>;
      }
    }, {
      tooltip: <span class="hljs-string">'HANDOVER_WAREHOUSE'</span>,
      angle: <span class="hljs-string">'angle-right'</span>,
      icon: <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>{
        <span class="hljs-keyword">return</span> <span class="hljs-string">'arrows-alt'</span>;
      },
      isActive: <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>{
        <span class="hljs-keyword">return</span> self.state &gt;= <span class="hljs-number">2</span> &amp;&amp; self.state &lt; <span class="hljs-number">7</span>;
      },
      showCheckmark: <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>{
        <span class="hljs-keyword">return</span> self.state &gt;= <span class="hljs-number">2</span> &amp;&amp; self.state &lt; <span class="hljs-number">7</span>;
      },
      showCross: <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>{
        <span class="hljs-keyword">return</span> self.errorState === <span class="hljs-number">1</span>;
      }
    }, {
      tooltip: <span class="hljs-string">'DELIVERED'</span>,
      angle: <span class="hljs-string">'angle-right'</span>,
      icon: <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>{
        <span class="hljs-keyword">return</span> <span class="hljs-string">'home'</span>;
      },
      isActive: <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>{
        <span class="hljs-keyword">return</span> self.state &gt;= <span class="hljs-number">4</span> &amp;&amp; self.state &lt; <span class="hljs-number">7</span>;
      },
      showCheckmark: <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>{
        <span class="hljs-keyword">return</span> self.state &gt;= <span class="hljs-number">4</span> &amp;&amp; self.state &lt; <span class="hljs-number">7</span>;
      },
      showCross: <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>{
        <span class="hljs-keyword">return</span> self.errorState === <span class="hljs-number">2</span>;
      }
    }, {
      tooltip: <span class="hljs-string">'SUCCESS'</span>,
      angle: <span class="hljs-string">'angle-right'</span>,
      icon: <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>{
        <span class="hljs-keyword">return</span> self.state === <span class="hljs-number">5</span> &amp;&amp; <span class="hljs-literal">false</span> ? <span class="hljs-string">'close'</span> : <span class="hljs-string">'check'</span>;
      },
      isActive: <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>{
        <span class="hljs-keyword">return</span> self.state === <span class="hljs-number">5</span>;
      },
      showCheckmark: <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>{
        <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;
      }
    } ];

    <span class="hljs-keyword">var</span> getCarrierInfoByEvents = <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"> events </span>) </span>{</div></div></div><div class="segment"><div class="comments "><div class="wrapper"><p>events.push({
  carrier: {
    code: &#39;hermes&#39;
  }</p></div></div><div class="code"><div class="wrapper">      <span class="hljs-comment">// );</span>

      <span class="hljs-keyword">var</span> uniqueBy = <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"> a, key </span>) </span>{
        <span class="hljs-keyword">var</span> seen = {};
        <span class="hljs-keyword">return</span> a.filter( <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"> item </span>) </span>{
          <span class="hljs-keyword">var</span> k = key( item );</div></div></div><div class="segment"><div class="comments "><div class="wrapper"><p>var k = key;</p></div></div><div class="code"><div class="wrapper">          <span class="hljs-keyword">return</span> seen.hasOwnProperty( k ) ? <span class="hljs-literal">false</span> : ( seen[ k ] = <span class="hljs-literal">true</span> );
        } );
      };</div></div></div><div class="segment"><div class="comments "><div class="wrapper"><p>create an array that only contains all the carriers from the events</p></div></div><div class="code"><div class="wrapper">      <span class="hljs-keyword">var</span> unfilteredCarriers = events.map( <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"> event </span>) </span>{
        <span class="hljs-keyword">return</span> event.carrier;
      } );</div></div></div><div class="segment"><div class="comments "><div class="wrapper"><p>filter dublicates</p></div></div><div class="code"><div class="wrapper">      <span class="hljs-keyword">return</span> uniqueBy( unfilteredCarriers, <span class="hljs-built_in">JSON</span>.stringify );
    };</div></div></div><div class="segment"><div class="comments "><div class="wrapper"><p>get trackingId from URL</p></div></div><div class="code"><div class="wrapper">    <span class="hljs-keyword">if</span> ( $routeParams.trackingId ) {
      self.trackingId = $routeParams.trackingId;
      StorageTracking.trackingId = self.trackingId;
    }

    <span class="hljs-keyword">if</span> ( self.trackingId ) {
      StorageTracking.track( self.trackingId, <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"> response </span>) </span>{
        self.data = response;

        <span class="hljs-keyword">if</span> ( response &amp;&amp; response.events ) {
          <span class="hljs-keyword">if</span> ( !!response.events.length ) {
            self.state = self.availableStates.indexOf( response.events[ response.events.length - <span class="hljs-number">1</span> ].status );

            self.showError = response.events[ response.events.length - <span class="hljs-number">1</span> ].status === <span class="hljs-string">'NOT_AVAILABLE'</span>;
            self.carrierInfo = getCarrierInfoByEvents( response.events );</div></div></div><div class="segment"><div class="comments "><div class="wrapper"><p>&#39;LABEL_PRINTED&#39;,
&#39;IN_TRANSIT&#39;,
&#39;HANDOVER&#39;,
&#39;WAREHOUSE&#39;,
&#39;IN_DELIVERY&#39;,
&#39;DELIVERED&#39;</p>
<p>&#39;NOT_AVAILABLE&#39;,
&#39;NO_HANDOVER&#39;,
&#39;DELIVERY_FAILED&#39;,
&#39;RECEIVER_MOVED&#39;,
&#39;CANCELLED&#39;</p></div></div><div class="code"><div class="wrapper">            self.state = self.availableStates.indexOf( <span class="hljs-string">'RECEIVER_MOVED'</span> );
            self.errorState = self.errorStates.indexOf( <span class="hljs-string">'RECEIVER_MOVED'</span> );

            <span class="hljs-built_in">console</span>.log( self.state );
            <span class="hljs-built_in">console</span>.log( self.errorState );

          } <span class="hljs-keyword">else</span> {
            self.showError = <span class="hljs-literal">true</span>;
          }
        }
      }, <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"> error </span>) </span>{
        self.data = <span class="hljs-literal">null</span>;
        self.showError = <span class="hljs-literal">true</span>;
        self.state = -<span class="hljs-number">1</span>;
      } );
    }

    self.getStatus = <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>{
      <span class="hljs-keyword">if</span> ( self.trackingId ) {
        CommonTracking.addEvent( <span class="hljs-string">'track'</span>, <span class="hljs-string">'"Jetzt Sendung verfolgen" button was used for "'</span> + self.trackingId + <span class="hljs-string">'".'</span> );
        $location.path( <span class="hljs-string">'/tracking/'</span> + self.trackingId );
      }
    };

    self.banner = {
      title: $filter( <span class="hljs-string">'translate'</span> )( <span class="hljs-string">'SECTION.FOOTER.TITLE'</span> ),
      subtitle: $filter( <span class="hljs-string">'translate'</span> )( <span class="hljs-string">'SECTION.FOOTER.SUBTITLE'</span> ),
      trackingId: self.trackingId
    };
  }
];</div></div></div></div></body></html>